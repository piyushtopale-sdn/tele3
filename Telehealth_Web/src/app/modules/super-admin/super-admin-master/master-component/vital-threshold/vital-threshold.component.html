

<div class="tab_content">
  <div class="top_bar">
    <div class="left_part">
      <div class="search_bar common_content">
        <div class="input-group">
          <button class="btn search-btn">
            <mat-icon>search</mat-icon>
          </button>
          <input type="search" class="form-control" placeholder="Search..." aria-label="Search" [ngModel]="searchText"
            #text (keyup)="handleSearchFilter(text.value)" (search)="handleSearchFilter(text.value)" />
        </div>
      </div>
      <div class="content_wrap">
        <div class="policy">
          <form [formGroup]="dateRangeForm">
            <div class="form_field_wrapper d-flex align-items-center gap-3" style="margin: 10px;">
              <div class="from_title_change">{{ "from" | translate }}:</div>
              <mat-form-field class="example-full-width choosedate" appearance="fill">
                <input matInput [matDatepickerFilter]="myFilter" placeholder="{{ 'select_date' | translate }}"
                  [matDatepicker]="picker1" formControlName="fromDate"
                  (dateChange)="onDateChange('from', $event.value)"  (click)="picker1.open()" readonly/>
                <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                <mat-datepicker #picker1></mat-datepicker>
              </mat-form-field>

              <div class="from_title_change">{{ "to" | translate }}:</div>
              <mat-form-field class="example-full-width choosedate" appearance="fill">
                <input matInput [matDatepickerFilter]="myFilter" placeholder="{{ 'select_date' | translate }}"
                  [matDatepicker]="picker2" formControlName="toDate" (dateChange)="onDateChange('to', $event.value)" (click)="picker1.open()" readonly/>
                <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                <mat-datepicker #picker2></mat-datepicker>
              </mat-form-field>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div class="right_part">
      <div class="primary_btn">
        <ng-container *ngIf="giveInnerPermission('deletedAll')">
          <button type="button" class="btn btn-primary" (click)="openVerticallyCenteredsecond(deletePopupAll, '')">
            <mat-icon>delete</mat-icon>{{ 'delete_all_vital_threshold' | translate }}
          </button>
        </ng-container>
        <ng-container *ngIf="giveInnerPermission('selectedDelete')">
          <button type="button" class="btn btn-primary" [disabled]="selectedMedicines.length === 0"
            (click)="openVerticallyCenteredsecond(deletePopupSelected, '')">
            <mat-icon>delete</mat-icon>{{ "delete_vital_threshold" | translate }}
          </button>
        </ng-container>
        <button type="button" class="btn btn-primary" (click)="openVerticallyCenteredAddcontent(addcontentData)">
          {{ "add_vital_threshold" | translate }}
        </button>
      </div>

    </div>
  </div>
  <div class="bottom_bar">
    <div class="table-wrap">
      <div class="table-inner">
        <!-- <table mat-table [dataSource]="resultSource" class="mat-elevation-z8">

          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef (click)="onSortData('createdAt')">
                {{ 'creation_date_time' | translate }}
                <span *ngIf="sortColumn === 'createdAt'" class="material-icons sorticon">
                    {{ sortIconClass }}
                </span>
            </th>

            <td mat-cell *matCellDef="let element">
                {{ element?.data.createdAt | date : "dd/MM/yyy" }} |
                <span>{{ element?.data[0]?.createdAt | date : "HH:mm " }} </span>
            </td>
        </ng-container>
          <ng-container matColumnDef="type_of_result">
            <th mat-header-cell *matHeaderCellDef>
              {{ "vital_type" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              {{ getFormattedType(element?.data[0].vitalsType) }}
            </td>
          </ng-container>

          <ng-container matColumnDef="high">
            <th mat-header-cell *matHeaderCellDef>
              {{ "high" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              <ng-container *ngIf="element?.vitalsType === 'BLOOD_PRESSURE'; else genericHigh">
                {{ element?.BPSystolic?.high }} /
                {{ element?.BPDiastolic?.high }}
              </ng-container>
              <ng-template #genericHigh>
                {{ element?.high }}
              </ng-template>
            </td>
          </ng-container>

          <ng-container matColumnDef="low">
            <th mat-header-cell *matHeaderCellDef>
              {{ "low" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              <ng-container *ngIf="element?.vitalsType === 'BLOOD_PRESSURE'; else genericLow">
                {{ element?.BPSystolic?.low }} /
                {{ element?.BPDiastolic?.low }}
              </ng-container>
              <ng-template #genericLow>
                {{ element?.low }}
              </ng-template>
            </td>
          </ng-container>

          <ng-container matColumnDef="critical_high">
            <th mat-header-cell *matHeaderCellDef>
              {{ "critical_high" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              <ng-container *ngIf="element?.vitalsType === 'BLOOD_PRESSURE'; else genericCriticalHigh">
                {{ element?.BPSystolic?.criticalHigh }} /
                {{ element?.BPDiastolic?.criticalHigh }}
              </ng-container>
              <ng-template #genericCriticalHigh>
                {{ element?.criticalHigh }}
              </ng-template>
            </td>
          </ng-container>

          <ng-container matColumnDef="critical_low">
            <th mat-header-cell *matHeaderCellDef>
              {{ "critical_low" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              <ng-container *ngIf="element?.vitalsType === 'BLOOD_PRESSURE'; else genericCriticalLow">
                {{ element?.BPSystolic?.criticalLow }} /
                {{ element?.BPDiastolic?.criticalLow }}
              </ng-container>
              <ng-template #genericCriticalLow>
                {{ element?.criticalLow }}
              </ng-template>
            </td>
          </ng-container>

          <ng-container matColumnDef="interpretive_data">
            <th mat-header-cell *matHeaderCellDef>
              {{ "unit" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              <ng-container *ngIf="element?.vitalsType === 'BLOOD_PRESSURE'; else genericUnit">
                {{ element?.BPSystolic?.unit }} /
                {{ element?.BPDiastolic?.unit }}
              </ng-container>
              <ng-template #genericUnit>
                {{ element?.unit }}
              </ng-template>
            </td>
          </ng-container>


          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef>
              {{ "action" | translate }}
              <ng-container *ngIf="giveInnerPermission('selectedDelete')">
                <mat-checkbox (change)="makeSelectAll($event)" style="margin-left: 10px"
                    [checked]="isAllSelected()">
                </mat-checkbox>
            </ng-container>
            </th>
            <td mat-cell *matCellDef="let element">
              <div class="icon_group">
                <ng-container *ngIf="giveInnerPermission('edit')">
                  <a class="svgicon" (click)="openVerticallyCenteredEdit(editOpencontentData, element?.data[0]?._id , element?.data[0]?.vitalsType)">
                    <svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M10.5142 0.0229199C10.3428 0.0573628 10.1536 0.141476 10.0166 0.244171C9.94218 0.300012 9.72307 0.505285 9.52976 0.700352L9.17827 1.05501L10.063 1.94044L10.9477 2.82587L11.3237 2.45061C11.7438 2.03136 11.8395 1.90759 11.9242 1.6743C12.0906 1.21545 11.979 0.720952 11.6302 0.371924C11.3334 0.0748893 10.9118 -0.0569464 10.5142 0.0229199ZM6.64187 3.59457C5.03559 5.20381 4.6412 5.61079 4.62404 5.67686C4.61229 5.72203 4.52518 6.14963 4.43044 6.62709C4.31571 7.20542 4.26371 7.51693 4.27468 7.56031C4.29571 7.64339 4.36459 7.71235 4.44763 7.7334C4.5351 7.75559 6.32498 7.39974 6.41623 7.34202C6.45238 7.31917 7.36806 6.41253 8.4511 5.32729L10.4203 3.35415L9.54134 2.47426C9.05794 1.99034 8.65701 1.59439 8.65039 1.59439C8.64378 1.59439 7.73994 2.49446 6.64187 3.59457ZM1.27858 2.01904C0.801035 2.08971 0.368127 2.40948 0.154276 2.84954C-0.00886787 3.18522 -0.00024066 2.95256 0.000204767 7.00711C0.000673638 11.0892 -0.00959462 10.8343 0.168764 11.1905C0.339315 11.5312 0.644737 11.7944 1.03519 11.9371L1.20715 12H4.99328H8.7794L8.96695 11.9363C9.45195 11.7716 9.813 11.3872 9.9558 10.8835C9.99568 10.7429 9.99847 10.5901 9.99847 8.54919V6.36534L9.92778 6.25089C9.82569 6.08565 9.65157 5.9963 9.46356 6.01273C9.29873 6.02711 9.17157 6.10357 9.07852 6.2443L9.01384 6.34207L9.00212 8.50235C8.9914 10.4772 8.98697 10.6689 8.95056 10.7354C8.8943 10.8382 8.76044 10.9493 8.65672 10.9794C8.59422 10.9975 7.50926 11.0029 4.94437 10.998L1.32036 10.9911L1.22857 10.927C1.1781 10.8917 1.11044 10.8238 1.07821 10.7762L1.0196 10.6896L1.01353 7.03304C1.0076 3.46853 1.00858 3.37432 1.0524 3.28904C1.07713 3.24094 1.12735 3.17309 1.16396 3.13829C1.31372 2.99606 1.21017 3.00214 3.48356 3.00214C5.06037 3.00214 5.58551 2.99517 5.6587 2.97328C5.79228 2.93335 5.9376 2.78251 5.9765 2.64347C6.03895 2.42022 5.94597 2.18618 5.7487 2.07014L5.63797 2.00498L3.52806 2.00168C2.3676 1.99987 1.35533 2.00766 1.27858 2.01904Z" />
                    </svg>
                  </a>
                </ng-container>
               
                <ng-container *ngIf="giveInnerPermission('selectedDelete')">
                  <mat-checkbox style="margin-left: 10px" [checked]="selectedMedicines.includes(element?._id)"
                    (change)="handleCheckBoxChange($event, element?._id)">
                  </mat-checkbox>
                </ng-container>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table> -->



        <table mat-table [dataSource]="resultSource" class="mat-elevation-z8">

          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef (click)="onSortData('createdAt')">
              {{ 'creation_date_time' | translate }}
              <span *ngIf="sortColumn === 'createdAt'" class="material-icons sorticon">
                {{ sortIconClass }}
              </span>
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element?.createdAt | date : "dd/MM/YYYY" }} |
              <span>{{ element?.createdAt | date : "HH:mm " }}</span>
            </td>
          </ng-container>
        
          <ng-container matColumnDef="type_of_result">
            <th mat-header-cell *matHeaderCellDef>
              {{ "vital_type" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element?.vitalsType }}
            </td>
          </ng-container>
        
          <ng-container matColumnDef="high">
            <th mat-header-cell *matHeaderCellDef>
              {{ "high" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element?.referenceRange?.[0]?.high }}
            </td>
          </ng-container>
        
          <ng-container matColumnDef="low">
            <th mat-header-cell *matHeaderCellDef>
              {{ "low" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element?.referenceRange?.[0]?.low }}
            </td>
          </ng-container>
        
          <ng-container matColumnDef="critical_high">
            <th mat-header-cell *matHeaderCellDef>
              {{ "critical_high" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element?.referenceRange?.[0]?.criticalHigh }}
            </td>
          </ng-container>
        
          <ng-container matColumnDef="critical_low">
            <th mat-header-cell *matHeaderCellDef>
              {{ "critical_low" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element?.referenceRange?.[0]?.criticalLow }}
            </td>
          </ng-container>
        
          <ng-container matColumnDef="interpretive_data">
            <th mat-header-cell *matHeaderCellDef>
              {{ "unit" | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element?.referenceRange?.[0]?.unit }}
            </td>
          </ng-container>
        
          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef>
              {{ "action" | translate }}
              <ng-container *ngIf="giveInnerPermission('selectedDelete')">
                <mat-checkbox (change)="makeSelectAll($event)" style="margin-left: 10px" [checked]="isAllSelected()">
                </mat-checkbox>
              </ng-container>
            </th>
            <td mat-cell *matCellDef="let element">
              <div class="icon_group">
                <ng-container *ngIf="giveInnerPermission('edit')">
                  <a class="svgicon" (click)="openVerticallyCenteredEdit(editOpencontentData, element)">
                    <!-- Edit Icon -->
                    <svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M10.5142 0.0229199C10.3428 0.0573628 10.1536 0.141476 10.0166 0.244171C9.94218 0.300012 9.72307 0.505285 9.52976 0.700352L9.17827 1.05501L10.063 1.94044L10.9477 2.82587L11.3237 2.45061C11.7438 2.03136 11.8395 1.90759 11.9242 1.6743C12.0906 1.21545 11.979 0.720952 11.6302 0.371924C11.3334 0.0748893 10.9118 -0.0569464 10.5142 0.0229199ZM6.64187 3.59457C5.03559 5.20381 4.6412 5.61079 4.62404 5.67686C4.61229 5.72203 4.52518 6.14963 4.43044 6.62709C4.31571 7.20542 4.26371 7.51693 4.27468 7.56031C4.29571 7.64339 4.36459 7.71235 4.44763 7.7334C4.5351 7.75559 6.32498 7.39974 6.41623 7.34202C6.45238 7.31917 7.36806 6.41253 8.4511 5.32729L10.4203 3.35415L9.54134 2.47426C9.05794 1.99034 8.65701 1.59439 8.65039 1.59439C8.64378 1.59439 7.73994 2.49446 6.64187 3.59457ZM1.27858 2.01904C0.801035 2.08971 0.368127 2.40948 0.154276 2.84954C-0.00886787 3.18522 -0.00024066 2.95256 0.000204767 7.00711C0.000673638 11.0892 -0.00959462 10.8343 0.168764 11.1905C0.339315 11.5312 0.644737 11.7944 1.03519 11.9371L1.20715 12H4.99328H8.7794L8.96695 11.9363C9.45195 11.7716 9.813 11.3872 9.9558 10.8835C9.99568 10.7429 9.99847 10.5901 9.99847 8.54919V6.36534L9.92778 6.25089C9.82569 6.08565 9.65157 5.9963 9.46356 6.01273C9.29873 6.02711 9.17157 6.10357 9.07852 6.2443L9.01384 6.34207L9.00212 8.50235C8.9914 10.4772 8.98697 10.6689 8.95056 10.7354C8.8943 10.8382 8.76044 10.9493 8.65672 10.9794C8.59422 10.9975 7.50926 11.0029 4.94437 10.998L1.32036 10.9911L1.22857 10.927C1.1781 10.8917 1.11044 10.8238 1.07821 10.7762L1.0196 10.6896L1.01353 7.03304C1.0076 3.46853 1.00858 3.37432 1.0524 3.28904C1.07713 3.24094 1.12735 3.17309 1.16396 3.13829C1.31372 2.99606 1.21017 3.00214 3.48356 3.00214C5.06037 3.00214 5.58551 2.99517 5.6587 2.97328C5.79228 2.93335 5.9376 2.78251 5.9765 2.64347C6.03895 2.42022 5.94597 2.18618 5.7487 2.07014L5.63797 2.00498L3.52806 2.00168C2.3676 1.99987 1.35533 2.00766 1.27858 2.01904Z" />
                    </svg>
                  </a>
                </ng-container>
                <ng-container *ngIf="giveInnerPermission('selectedDelete')">
                  <mat-checkbox style="margin-left: 10px" [checked]="selectedMedicines.includes(element?._id)"
                    (change)="handleCheckBoxChange($event, element?._id)">
                  </mat-checkbox>
                </ng-container>
              </div>
            </td>
          </ng-container>
        
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
        
      </div>
      <div *ngIf="resultSource?.length === 0" class="text-center">
        <b>{{ "no_record_found" | translate }}</b>
      </div>
      <mat-paginator #paginator class="pagination" [length]="totalLength" (page)="handlePageEvent($event)"
        [pageSize]="pageSize" [pageSizeOptions]="[2, 5, 10, 20]" showFirstLastButtons>
      </mat-paginator>
    </div>
  </div>
</div>

<!-- Delete modal -->
<ng-template #deletePopupSelected let-modal>
  <div class="custome_modal action_modals">
    <div class="modal-body">
      <div class="delete_screen text-center">
        <div class="image delete">
          <img class="img-fluid" src="../../../../assets/img/delete.svg" alt="" />
        </div>
        <p class="heading delete">{{ "are_you_sure" | translate }}</p>
        <p>{{ "want_to_delete_selected_vital" | translate }}</p>
        <div class="primary_btn mt-30">
          <button type="button" class="btn btn-secondary" (click)="modal.dismiss('Cross click')">
            {{ "no" | translate }}
          </button>
          <button type="button" class="btn btn-primary" (click)="deleteMed()">
            {{ "yes" | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #deletePopupAll let-modal>
  <div class="custome_modal action_modals">
    <div class="modal-body">
      <div class="delete_screen text-center">
        <div class="image delete">
          <img class="img-fluid" src="../../../../assets/img/delete.svg" alt="" />
        </div>
        <p class="heading delete">{{ 'are_you_sure' | translate }}</p>
        <p>{{ 'want_to_delete_selected_all_vital' | translate }}</p>
        <div class="primary_btn mt-30">
          <button type="button" class="btn btn-secondary" (click)="modal.dismiss('Cross click')">
            {{ 'no' | translate }}
          </button>
          <button type="button" class="btn btn-primary" (click)="deleteMed('all')">
            {{ 'yes' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<!-- ---------------------------------Add-Vital-Threshold----------------------------------------------------- -->
<div class="add_service">
  <ng-template #addcontentData let-modal>
      <div class="custome_modal">
          <div class="modal-header">
              <h4 class="modal-title" id="modal-basic-title">
                {{ "add_vital_threshold" | translate }}
              </h4>
              <button type="button" class="btn-close" aria-label="Close" (click)="closePopup()">
                  <mat-icon>close</mat-icon>
              </button>
          </div>
          <div class="modal-body">
              <form [formGroup]="testConfigForm" (ngSubmit)="submitForm()">
                  <div class="modal_content Speciality_service">
                      <div class="row">
                          <div class="item mb-3 col-6">
                            <div class="form_field_wrapper label-type">
                              <label>{{ "select_vital_type" | translate }}<span class="danger">*</span></label>
                              <mat-form-field appearance="fill">
                                <mat-select formControlName="vitalsType" placeholder="Select Vitals Type" (selectionChange)="onValueChange($event)">
                                  <mat-option *ngFor="let type of vitalsTypes" [value]="type">
                                    {{ type }}
                                  </mat-option>
                                </mat-select>
                              </mat-form-field>
                              <mat-error
                                *ngIf="testConfigForm.get('vitalsType').invalid && testConfigForm.get('vitalsType').touched">
                                {{ "field_is_required" | translate }}
                              </mat-error>
                            </div>
                          </div>
                          <div class="item mb-3" formArrayName="refrence_range">
                            <div *ngFor="let option of options.controls; let i = index" [formGroupName]="i">
                              <div class="reference-field">
                                <p style="font-weight: 500; margin-left: -9px; font-size: 1rem">
                                  {{ "reference_ranges" | translate }}
                                </p>
                                <ng-container *ngIf="testConfigForm.get('vitalsType')?.value === 'BLOOD_PRESSURE'">
                                  <label>
                                    <p>
                                      <b>{{ i % 2 === 0 ? 'BPSystolic' : 'BPDiastolic' }}</b>
                                    </p>
                                  </label> <br>
                                </ng-container>
                              </div>
                              <div class="create_profile_inner refrence">
                                <div class="form reference-field" >
                                  <div class="row-refrence">
                                    <!-- Gender Field -->
                                    <div class="ml-3">
                                      <div class="form_field_wrapper">
                                        <label>{{ "gender" | translate }}<span class="danger">*</span></label>
                                        <mat-form-field appearance="fill">
                                          <mat-select disableRipple formControlName="gender">
                                            <mat-option value="male">{{ "male" | translate }}</mat-option>
                                            <mat-option value="female">{{ "female" | translate }}</mat-option>
                                            <mat-option value="All">{{ "all" | translate }}</mat-option>
                                          </mat-select>
                                        </mat-form-field>
                                        <mat-error
                                          *ngIf="options.at(i).get('gender').invalid && options.at(i).get('gender').touched">
                                          {{ "field_is_required" | translate }}
                                        </mat-error>
                                      </div>
                                    </div>
                                    <!-- Age Field -->
                                    <div class="mb-3">
                                      <div class="form_field_wrapper">
                                        <label>{{ "age" | translate }}(yr)<span class="danger">*</span></label>
                                        <mat-form-field appearance="fill">
                                          <mat-select disableRipple formControlName="age">
                                            <mat-option *ngFor="let range of ageRanges" [value]="range">
                                              {{ range }}
                                            </mat-option>
                                          </mat-select>
                                        </mat-form-field>
                                        <mat-error *ngIf="options.at(i).get('age').invalid && options.at(i).get('age').touched">
                                          {{ "field_is_required" | translate }}
                                        </mat-error>
                                      </div>
                                    </div>
                                    <!-- High Field -->
                                    <div class="mb-3">
                                      <div class="form_field_wrapper">
                                        <label>{{ "high" | translate }}<span class="danger">*</span></label>
                                        <mat-form-field appearance="fill">
                                          <input type="number" matInput formControlName="high"
                                            />
                                        </mat-form-field>
                                        <mat-error *ngIf="options.at(i).get('high').invalid && options.at(i).get('high').touched">
                                          {{ "field_is_required" | translate }}
                                        </mat-error>
                                      </div>
                                    </div>
          
                                    <!-- Low Field -->
                                    <div class="mb-3">
                                      <div class="form_field_wrapper">
                                        <label>{{ "low" | translate }}<span class="danger">*</span></label>
                                        <mat-form-field appearance="fill">
                                          <input type="number" matInput formControlName="low"
                                           />
                                        </mat-form-field>
                                        <mat-error *ngIf="options.at(i).get('low').invalid && options.at(i).get('low').touched">
                                          {{ "field_is_required" | translate }}
                                        </mat-error>
                                      </div>
                                    </div>
          
                                    <!-- Critical High Field -->
                                    <div class="mb-3">
                                      <div class="form_field_wrapper">
                                        <label>{{ "critical_high" | translate }}<span class="danger">*</span></label>
                                        <mat-form-field appearance="fill">
                                          <input type="number" matInput formControlName="criticalHigh"
                                            />
                                        </mat-form-field>
                                        <mat-error
                                          *ngIf="options.at(i).get('criticalHigh').invalid && options.at(i).get('criticalHigh').touched">
                                          {{ "field_is_required" | translate }}
                                        </mat-error>
                                      </div>
                                    </div>
          
                                    <!-- Critical Low Field -->
                                    <div class="mb-3">
                                      <div class="form_field_wrapper">
                                        <label>{{ "critical_low" | translate }}<span class="danger">*</span></label>
                                        <mat-form-field appearance="fill">
                                          <input type="number" matInput formControlName="criticalLow"
                                             />
                                        </mat-form-field>
                                        <mat-error
                                          *ngIf="options.at(i).get('criticalLow').invalid && options.at(i).get('criticalLow').touched">
                                          {{ "field_is_required" | translate }}
                                        </mat-error>
                                      </div>
                                    </div>
          
                                    <!-- Unit Field -->
                                    <div class="mb-3">
                                      <div class="form_field_wrapper">
                                        <label>{{ "unit" | translate }}<span class="danger">*</span></label>
                                        <mat-form-field appearance="fill">
                                          <input type="text" matInput formControlName="unit" />
                                        </mat-form-field>
                                        <mat-error *ngIf="options.at(i).get('unit').invalid && options.at(i).get('unit').touched">
                                          {{ "field_is_required" | translate }}
                                        </mat-error>
                                      </div>
                                    </div>
                                    <!-- Remove/Add Button Logic -->
                                    <!-- <ng-container *ngFor="let field of options.controls; let i = index"> -->
                                      <div class="row_generate d-flex align-items-center">
                                    
                                        <!-- Remove button - visible only for the second to last field -->
                                        <ng-container *ngIf="i === options.length - 2 ; else remove">
                                          <div
                                            class="row_generate row_minus"
                                            (click)="removeOption(i)"
                                            *ngIf="options.length > 1"
                                            style="background-color: lightcoral; border-radius: 8px; padding: 8px; display: inline-block; margin-right: 10px;"
                                          >
                                            <mat-icon class="btnminus" style="color: white;">remove</mat-icon>
                                          </div>
                                        </ng-container>
                                    
                                        <!-- Add button - visible only for the last field -->
                                        <ng-container *ngIf="i === options.length - 1">
                                          <div
                                            class="row_generate row_add"
                                            (click)="addOption()"
                                            style="border-radius: 8px; padding: 8px; display: inline-block;"
                                          >
                                            <mat-icon class="addbtns">add</mat-icon>
                                          </div>
                                        </ng-container>
                                    
                                      </div>
                                    <!-- </ng-container> -->
                                    
                                    <ng-template #remove>
                                      <div class="row_generate addbtn d-flex justify-content-center align-items-center pm_iconbtn"
                                        (click)="removeOption(i)">
                                        <!-- <mat-icon class="plus btnminusre">remove</mat-icon> -->
                                      </div>
                                    </ng-template>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                      </div>    
                  </div>
                  <mat-error
                  *ngIf="
                    options.hasError('duplicateCombination')
                  "
                >
                  {{
                    "Duplicate gender and age combination is not allowed."
                      | translate
                  }}
                </mat-error>
                  <div class="primary_btn">
                      <button type="button" class="btn btn-secondary" (click)="closePopup()">
                          {{ 'cancel' | translate }}
                      </button>
                      <button type="submit" class="btn btn-primary">Save</button>
                  </div>
              </form>
          </div>
      </div>
  </ng-template>
</div>

<!-- ---------------------------------Edit-Vital-Threshold----------------------------------------------------- -->
<div class="edit_service">
  <ng-template #editOpencontentData let-modal>
      <div class="custome_modal">
          <div class="modal-header">
              <h4 class="modal-title" id="modal-basic-title">
                {{ "edit_vital_threshold" | translate }}
              </h4>
              <button type="button" class="btn-close" aria-label="Close" (click)="closePopup()">
                  <mat-icon>close</mat-icon>
              </button>
          </div>

          <div class="modal-body">
            <form [formGroup]="testConfigFormEdit" (ngSubmit)="submitFormEdit(resultSource)">
              <div class="modal_content Speciality_service">
                <div class="row">
                  <!-- Select Vitals Type -->
                  <div class="item mb-3 col-6">
                    <div class="form_field_wrapper label-type">
                      <label>
                        {{ "select_vital_type" | translate }}<span class="danger">*</span>
                      </label>
                      <mat-form-field appearance="fill">
                        <mat-select
                          formControlName="vitalsType"
                          placeholder="Select Vitals Type"
                          (selectionChange)="onValueChange($event)"
                        >
                          <mat-option
                            *ngFor="let type of vitalsTypes"
                            [value]="type"
                          >
                            {{ type }}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                      <mat-error
                        *ngIf="testConfigFormEdit.get('vitalsType').invalid && testConfigFormEdit.get('vitalsType').touched"
                      >
                        {{ "field_is_required" | translate }}
                      </mat-error>
                    </div>
                  </div>
            
                  <!-- Reference Range Fields -->
                  <div class="item mb-3" formArrayName="refrence_range">
                    <div *ngFor="let option of optionsEdit.controls; let i = index" [formGroupName]="i">
                      <div class="reference-field">
                        <p style="font-weight: 500; margin-left: -9px; font-size: 1rem">
                          {{ "reference_ranges" | translate }}
                        </p>
                        <ng-container *ngIf="testConfigFormEdit.get('vitalsType')?.value === 'BLOOD_PRESSURE'">
                          <label>
                            <p>
                              <b>{{ i % 2 === 0 ? 'BPSystolic' : 'BPDiastolic' }}</b>
                            </p>
                          </label>
                          <br />
                        </ng-container>
                      </div>
                      <div class="create_profile_inner refrence">
                        <div class="form reference-field">
                          <div class="row-refrence">
                            <!-- Gender Field -->
                            <div class="ml-3">
                              <div class="form_field_wrapper">
                                <label>
                                  {{ "gender" | translate }}<span class="danger">*</span>
                                </label>
                                <mat-form-field appearance="fill">
                                  <mat-select disableRipple formControlName="gender">
                                    <mat-option value="male">{{ "male" | translate }}</mat-option>
                                    <mat-option value="female">{{ "female" | translate }}</mat-option>
                                    <mat-option value="All">{{ "all" | translate }}</mat-option>
                                  </mat-select>
                                </mat-form-field>
                                <mat-error
                                  *ngIf="option.get('gender').invalid && option.get('gender').touched"
                                >
                                  {{ "field_is_required" | translate }}
                                </mat-error>
                              </div>
                            </div>
            
                            <!-- Age Field -->
                            <div class="mb-3">
                              <div class="form_field_wrapper">
                                <label>
                                  {{ "age" | translate }}(yr)<span class="danger">*</span>
                                </label>
                                <mat-form-field appearance="fill">
                                  <mat-select disableRipple formControlName="age">
                                    <mat-option
                                      *ngFor="let range of ageRanges"
                                      [value]="range"
                                    >
                                      {{ range }}
                                    </mat-option>
                                  </mat-select>
                                </mat-form-field>
                                <mat-error
                                  *ngIf="option.get('age').invalid && option.get('age').touched"
                                >
                                  {{ "field_is_required" | translate }}
                                </mat-error>
                              </div>
                            </div>
            
                            <!-- High Field -->
                            <div class="mb-3">
                              <div class="form_field_wrapper">
                                <label>
                                  {{ "high" | translate }}<span class="danger">*</span>
                                </label>
                                <mat-form-field appearance="fill">
                                  <input
                                    type="number"
                                    matInput
                                    formControlName="high"
                                  />
                                </mat-form-field>
                                <mat-error
                                  *ngIf="option.get('high').invalid && option.get('high').touched"
                                >
                                  {{ "field_is_required" | translate }}
                                </mat-error>
                              </div>
                            </div>
            
                            <!-- Low Field -->
                            <div class="mb-3">
                              <div class="form_field_wrapper">
                                <label>
                                  {{ "low" | translate }}<span class="danger">*</span>
                                </label>
                                <mat-form-field appearance="fill">
                                  <input
                                    type="number"
                                    matInput
                                    formControlName="low"
                                  />
                                </mat-form-field>
                                <mat-error
                                  *ngIf="option.get('low').invalid && option.get('low').touched"
                                >
                                  {{ "field_is_required" | translate }}
                                </mat-error>
                              </div>
                            </div>
            
                            <!-- Critical High Field -->
                            <div class="mb-3">
                              <div class="form_field_wrapper">
                                <label>
                                  {{ "critical_high" | translate }}<span class="danger">*</span>
                                </label>
                                <mat-form-field appearance="fill">
                                  <input
                                    type="number"
                                    matInput
                                    formControlName="criticalHigh"
                                  />
                                </mat-form-field>
                                <mat-error
                                  *ngIf="option.get('criticalHigh').invalid && option.get('criticalHigh').touched"
                                >
                                  {{ "field_is_required" | translate }}
                                </mat-error>
                              </div>
                            </div>
            
                            <!-- Critical Low Field -->
                            <div class="mb-3">
                              <div class="form_field_wrapper">
                                <label>
                                  {{ "critical_low" | translate }}<span class="danger">*</span>
                                </label>
                                <mat-form-field appearance="fill">
                                  <input
                                    type="number"
                                    matInput
                                    formControlName="criticalLow"
                                  />
                                </mat-form-field>
                                <mat-error
                                  *ngIf="option.get('criticalLow').invalid && option.get('criticalLow').touched"
                                >
                                  {{ "field_is_required" | translate }}
                                </mat-error>
                              </div>
                            </div>
            
                            <!-- Unit Field -->
                            <div class="mb-3">
                              <div class="form_field_wrapper">
                                <label>
                                  {{ "unit" | translate }}<span class="danger">*</span>
                                </label>
                                <mat-form-field appearance="fill">
                                  <input type="text" matInput formControlName="unit" />
                                </mat-form-field>
                                <mat-error
                                  *ngIf="option.get('unit').invalid && option.get('unit').touched"
                                >
                                  {{ "field_is_required" | translate }}
                                </mat-error>
                              </div>
                            </div>
            
                            <!-- Add/Remove Buttons -->
                            <div class="row_generate addbtn d-flex justify-content-center align-items-center pm_iconbtn">
                              <mat-icon
                                class="plus btnminus"
                                (click)="removeOption(i)"
                                *ngIf="optionsEdit.length > 1"
                              >
                                remove
                              </mat-icon>
                              <mat-icon
                                class="plus addbtns"
                                (click)="addOptionEdit()"
                                *ngIf="i === optionsEdit.length - 1"
                              >
                                add
                              </mat-icon>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <mat-error *ngIf="optionsEdit.hasError('duplicateCombination')">
                      {{ "Duplicate gender and age combination is not allowed." | translate }}
                    </mat-error>
                  </div>
                </div>
              </div>
            
              <!-- Submit/Cancel Buttons -->
              <div class="primary_btn">
                <button
                  type="button"
                  class="btn btn-secondary"
                  (click)="closePopup()"
                >
                  {{ "cancel" | translate }}
                </button>
                <button type="submit" class="btn btn-primary">Save</button>
              </div>
            </form>
            
        </div>
      </div>
  </ng-template>
</div>
